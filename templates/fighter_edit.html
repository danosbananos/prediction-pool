{% extends "base.html" %}

{% block title %}{{ 'Edit Fighter' if fighter else 'Add Fighter' }} â€” Prediction Pool{% endblock %}
{% block header %}{{ 'Edit Fighter' if fighter else 'Add Fighter' }}{% endblock %}
{% block subheader %}{{ fighter.name if fighter else 'Create a new fighter' }}{% endblock %}

{% block user_bar %}
<a href="{{ url_for('global_settings') }}" class="settings-gear" title="Back to Settings">&#8592;</a>
{% endblock %}

{% block content %}
{% if fighter and fighter.glory_id %}
<div style="
    margin-top: 1.5rem;
    padding: 0.65rem 1rem;
    border-radius: var(--radius-sm);
    font-size: 0.82rem;
    background: rgba(74, 144, 217, 0.12);
    color: var(--blue-accent);
    border: 1px solid rgba(74, 144, 217, 0.25);
">
    This fighter was synced from Glory (ID: {{ fighter.glory_id }}). Re-syncing will overwrite manual edits.
</div>
{% endif %}

<form method="post" action="{{ url_for('fighter_save') }}" style="margin-top: 1rem;">
    {% if fighter %}
    <input type="hidden" name="fighter_id" value="{{ fighter.id }}">
    {% endif %}

    <div class="card">
        <div class="section-title" style="margin-top: 0;">Name</div>

        <label style="margin-top: 0.5rem;">Name (display)</label>
        <input type="text" name="name" value="{{ fighter.name if fighter else '' }}" placeholder="Full display name">

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
                <label>First Name</label>
                <input type="text" name="first_name" value="{{ fighter.first_name or '' if fighter else '' }}" placeholder="First name">
            </div>
            <div>
                <label>Last Name</label>
                <input type="text" name="last_name" value="{{ fighter.last_name or '' if fighter else '' }}" placeholder="Last name">
            </div>
        </div>

        <label>Nickname</label>
        <input type="text" name="nickname" value="{{ fighter.nickname or '' if fighter else '' }}" placeholder="e.g. The Prince of Kickboxing">
    </div>

    <div class="card">
        <div class="section-title" style="margin-top: 0;">Nationality</div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 0.75rem;">
            <div>
                <label style="margin-top: 0.5rem;">Country</label>
                <input type="text" name="nationality" value="{{ fighter.nationality or '' if fighter else '' }}" placeholder="e.g. Netherlands">
            </div>
            <div>
                <label style="margin-top: 0.5rem;">Code (2-letter)</label>
                <input type="text" name="nationality_code" value="{{ fighter.nationality_code or '' if fighter else '' }}" placeholder="e.g. NL" maxlength="2" style="text-transform: uppercase;">
            </div>
        </div>
        {% if fighter and fighter.nationality_code %}
        <div style="margin-top: 0.5rem; font-size: 1.5rem;">{{ fighter.nationality_code|country_flag }}</div>
        {% endif %}
    </div>

    <div class="card">
        <div class="section-title" style="margin-top: 0;">Record</div>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 0.75rem;">
            <div>
                <label style="margin-top: 0.5rem;">Wins</label>
                <input type="number" name="wins" value="{{ fighter.wins if fighter else 0 }}" min="0">
            </div>
            <div>
                <label style="margin-top: 0.5rem;">Losses</label>
                <input type="number" name="losses" value="{{ fighter.losses if fighter else 0 }}" min="0">
            </div>
            <div>
                <label style="margin-top: 0.5rem;">Draws</label>
                <input type="number" name="draws" value="{{ fighter.draws if fighter else 0 }}" min="0">
            </div>
            <div>
                <label style="margin-top: 0.5rem;">KOs</label>
                <input type="number" name="kos" value="{{ fighter.kos if fighter else 0 }}" min="0">
            </div>
        </div>
    </div>

    <div class="card">
        <div class="section-title" style="margin-top: 0;">Details</div>

        <label style="margin-top: 0.5rem;">Weight Class</label>
        <input type="text" name="weight_class" value="{{ fighter.weight_class or '' if fighter else '' }}" placeholder="e.g. Heavyweight">

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
                <label>Height (cm)</label>
                <input type="text" name="height" value="{{ fighter.height or '' if fighter else '' }}" placeholder="e.g. 190">
            </div>
            <div>
                <label>Weight (kg)</label>
                <input type="text" name="weight" value="{{ fighter.weight or '' if fighter else '' }}" placeholder="e.g. 95">
            </div>
        </div>

        <label>Image URL</label>
        <input type="text" name="image_url" value="{{ fighter.image_url or '' if fighter else '' }}" placeholder="https://...">
        {% if fighter and fighter.image_url %}
        <div style="margin-top: 0.5rem;">
            <img src="{{ fighter.image_url }}" alt="{{ fighter.name }}" style="max-width: 80px; max-height: 100px; border-radius: var(--radius-sm); border: 1px solid var(--border);">
        </div>
        {% endif %}

        <label>Ranking</label>
        <input type="text" name="ranking" value="{{ fighter.ranking or '' if fighter else '' }}" placeholder="e.g. #1, Champion, Unranked">

        <label style="display: flex; align-items: center; gap: 0.5rem; margin-top: 1rem; cursor: pointer;">
            <input type="checkbox" name="retired" {{ 'checked' if fighter and fighter.retired else '' }} style="width: auto; accent-color: var(--crimson);">
            <span>Retired</span>
        </label>
    </div>

    <div style="display: flex; gap: 0.75rem; margin-top: 0.5rem; margin-bottom: 2rem;">
        <button type="submit" class="btn btn-primary" style="flex: 1;">Save Fighter</button>
        {% if fighter %}
        <button type="button" class="btn btn-danger" onclick="if(confirm('Delete {{ fighter.name }}? This cannot be undone.')){document.getElementById('delete-form').submit();}">Delete</button>
        {% endif %}
    </div>
</form>

{% if fighter %}
<form id="delete-form" method="post" action="{{ url_for('fighter_delete', fighter_id=fighter.id) }}" style="display: none;"></form>
{% endif %}
{% endblock %}
